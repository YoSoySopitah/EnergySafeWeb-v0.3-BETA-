{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mis Dispositivos - EnergySafe</title>
  <link rel="stylesheet" href="{% static 'css/add_devices.css' %}" />
  <link rel="stylesheet" href="{% static 'css/modals.css' %}" />
  <link rel="stylesheet" href="{% static 'css/styleshome.css' %}" />
  <style>
    .energy-safe-info {
      background-color: #f8f9fa;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .energy-safe-icon {
      width: 50px;
      height: 50px;
      margin-right: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .energy-safe-icon img {
      max-width: 100%;
      max-height: 100%;
    }
    
    .energy-safe-details {
      flex-grow: 1;
    }
    
    .energy-safe-name {
      font-weight: bold;
      font-size: 18px;
      color: #1C4268;
      margin-bottom: 5px;
    }
    
    .energy-safe-serial, .energy-safe-location {
      font-size: 14px;
      color: #666;
      margin-bottom: 2px;
    }
    
    .energy-safe-status {
      display: inline-block;
      background-color: #d4edda;
      color: #155724;
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 12px;
      margin-top: 5px;
    }
    
    .feedback {
      margin-top: 5px;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 14px;
      transition: opacity 0.3s ease;
    }

    .feedback.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .feedback.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .no-devices {
      text-align: center;
      padding: 40px 20px;
      background-color: #CEDDFF32;
      border-radius: 10px;
      margin: 50px 0;
      color: #4C4D4F;
    }

    body{
      margin-top:100px;
    }
    .no-devices h3 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #1C4268;
    }

    .no-devices p {
      margin-bottom: 20px;
    }

    .no-devices button {
      background-color: #01C38D;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .no-devices button:hover {
      background-color: #00b377;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="header-container">
    <div class="logo">
        <a href="{% url 'home' %}"><img src="https://i.imgur.com/2EhmVK6.png" alt=""></a>
    </div>
    <div class="optios">
      <a href="/home"><h2>Inicio</h2></a>
      <a href="/download"><h2>Descargar</h2></a>
      <a href="/devices"><h2>Dispositivos</h2></a>
      <a href="/products"><h2>Productos</h2></a>
      <a href="/about-us"><h2>Acerca de nosotros</h2></a>
      {% if user.is_authenticated %}
          <a href="{% url 'logout' %}" id="Login-Register"><h2>Cerrar sesión</h2></a>
      {% else %}
          <a href="{% url 'login' %}" id="Login-Register"><h2>Login/Register</h2></a>
      {% endif %}
  </div>
  </div>

  <!-- contenedor general-->
  <div class="div_general">
    {% if user_device %}
    <!-- Información del dispositivo EnergySafe -->
    <div class="energy-safe-info">
      <div class="energy-safe-icon">
        <img src="https://i.imgur.com/M8s3mYZ.png" alt="EnergySafe">
      </div>
      <div class="energy-safe-details">
        <div class="energy-safe-name">
          {{ user_device.nombre_personalizado|default:device_info.nombre }}
      </div>
      <div class="energy-safe-serial">
          Nº Serie: {{ device_info.numero_serie }}
      </div>
      <div class="energy-safe-location">
          Ubicación: {{ user_device.ubicacion|default:"No especificada" }}
      </div>
        <div class="energy-safe-status">Conectado</div>
      </div>
    </div>
    {% endif %}
    
    <!-- barra de titulo para mostrar los dispositivos -->
    <div class="div_titulo_agregar">
      <div class="div_titulo">
        <h3>{% if user_device %}Mis Electrodomésticos{% else %}Mis Dispositivos{% endif %}</h3>
      </div>
      <button class="btn_agregar" id="btn_agregar">
        {% if user_device %}Agregar Electrodoméstico{% else %}Registrar EnergySafe{% endif %}
      </button>
    </div>

    <!-- contenedor de dispositivos -->
    <div class="div_dispositivos">
      {% if user_device and appliances %}
        {% for appliance in appliances %}
          <div>
            <div class="linea_azul"></div>
            <div class="tarjeta_dispositivo">
              <div class="nombre_dispositivo">
                <h3>{{ appliance.nombre }}</h3>
              </div>
              <div class="contenido_dispositivo">
                <div class="estado_dispositivo">
                  <div class="circulo_estado normal"></div>
                  <span>Normal</span>
                </div>
                <div class="info_actualizacion">
                  <div class="icono_reloj"></div>
                  <span>Actualización hace 5 min</span>
                </div>
              </div>

              <div class="div_contenido">
                <div class="div_imagen">
                  <img
                    class="imagen"
                    src="{% if appliance.icono %}https://i.imgur.com/{{ appliance.icono }}.png{% else %}https://i.imgur.com/kyFdrai.jpeg{% endif %}"
                    alt="{{ appliance.nombre }}"
                  />
                </div>
                <div class="div_info_1">
                  <div class="div_marco_info">
                    <div class="div_icono_energia">
                      <div class="icono_electrico">
                        <img
                          class="icono"
                          src="https://i.imgur.com/3TtTtQa.jpeg"
                          alt="icono potencia"
                        />
                      </div>
                      <div class="info">
                        <span>Potencia</span>
                      </div>
                    </div>
                    <div class="div_valor_energia">
                      <span>120 w</span>
                    </div>
                  </div>
                  <div class="div_marco_info">
                    <div class="div_icono_energia">
                      <div class="icono_electrico">
                        <img
                          class="icono"
                          src="https://i.imgur.com/9MPENt5.jpeg"
                          alt="icono potencia"
                        />
                      </div>
                      <div class="info">
                        <span>Potencia Activa</span>
                      </div>
                    </div>
                    <div class="div_valor_energia">
                      <span>112 w</span>
                    </div>
                  </div>
                </div>

                <div class="div_info_2">
                  <div class="div_marco_info">
                    <div class="div_icono_energia">
                      <div class="icono_electrico">
                        <img
                          class="icono"
                          src="https://i.imgur.com/xrT4kle.jpeg"
                          alt="icono potencia"
                        />
                      </div>
                      <div class="info">
                        <span>Corriente</span>
                      </div>
                    </div>
                    <div class="div_valor_energia">
                      <span>1.1 A</span>
                    </div>
                  </div>
                  <div class="div_marco_info">
                    <div class="div_icono_energia">
                      <div class="icono_electrico">
                        <img
                          class="icono"
                          src="https://i.imgur.com/rX0s4cN.jpeg"
                          alt="icono potencia"
                        />
                      </div>
                      <div class="info">
                        <span>Voltaje</span>
                      </div>
                    </div>
                    <div class="div_valor_energia">
                      <span>{{ appliance.voltaje }} V</span>
                    </div>
                  </div>
                </div>

                <div class="div_datos_ad">
                  <div class="datos_adicionales">
                    <h3>Datos Adicionales</h3>
                    <div class="marco_datos">
                      <div class="fila_dato">
                        <span>Tipo:</span> <span>{{ appliance.tipo|title }}</span>
                      </div>
                      <div class="fila_dato">
                        <span>Conexión:</span> <span>{{ appliance.fecha_conexion|date:"d/m/Y" }}</span>
                      </div>
                      <div class="fila_dato">
                        <span>Consumo diario:</span> <span>1.5kWh</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="div_boton_mas_info">
                <a href="/devices-info"><button class="btn_mas_info"  >Mas Informacion</button></a>
              </div>
            </div>
          </div>
        {% endfor %}
      {% elif user_device %}
        <!-- Sin electrodomésticos pero con dispositivo EnergySafe -->
        <div class="no-devices">
          <h3>No tienes electrodomésticos registrados</h3>
          <p>Haz clic en "Agregar Electrodoméstico" para empezar a monitorear el consumo energético.</p>
          <button class="btn_agregar">Agregar Electrodoméstico</button>
        </div>
      {% else %}
        <!-- Sin dispositivo EnergySafe -->
        <div class="no-devices">
          <h3>No tienes un dispositivo EnergySafe registrado</h3>
          <p>Primero debes registrar tu dispositivo EnergySafe para empezar a monitorear tus electrodomésticos.</p>
          <button class="btn_agregar">Registrar EnergySafe</button>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Modal para Agregar Electrodoméstico o Registrar EnergySafe -->
  <div id="modal-agregar-dispositivo" class="modal">
    <div class="modal-contenido">
      <span class="cerrar-modal">&times;</span>
      <h2 id="modal-title">{% if user_device %}Agregar Electrodoméstico{% else %}Registrar Dispositivo EnergySafe{% endif %}</h2>
      
      {% if user_device %}
      <!-- Formulario para agregar electrodoméstico -->
      <form id="form-electrodomestico" method="POST" action="{% url 'add_appliance' %}">
        {% csrf_token %}
        <div class="campo-form">
          <label for="nombre-dispositivo">Nombre del Electrodoméstico</label>
          <input type="text" id="nombre-dispositivo" name="nombre-dispositivo" value="TV" placeholder="Ejemplo: Mi Televisor">
        </div>
        <div class="campo-form">
          <label for="voltaje">Voltaje</label>
          <select id="voltaje" name="voltaje">
            <option value="110 V" selected>110 V</option>
            <option value="120 V">120 V</option>
            <option value="220 V">220 V</option>
          </select>
        </div>
        
        <!-- Campo oculto para el ícono seleccionado -->
        <input type="hidden" id="icono-seleccionado" name="icono" value="television">
        
        <div class="acciones-form">
          <button type="button" class="btn-cancelar" id="cancelar">Cancelar</button>
          <button type="submit" class="btn-aceptar" id="btn-aceptar">Aceptar</button>
        </div>
      </form>
      {% else %}
      <!-- Formulario para registrar EnergySafe -->
      <form id="form-energysafe" method="POST" action="{% url 'register_device' %}">
        {% csrf_token %}
        <div class="campo-form">
          <label for="numero-serie">Número de Serie</label>
          <input type="text" id="numero-serie" name="numero_serie" placeholder="Ej: ESF12345678" required>
          <div id="serie-feedback" class="feedback" style="display: none;"></div>
        </div>
        <div class="campo-form">
          <label for="nombre-energysafe">Nombre del Dispositivo (opcional)</label>
          <input type="text" id="nombre-energysafe" name="nombre" placeholder="Ej: Mi EnergySafe">
        </div>
        <div class="campo-form">
          <label for="ubicacion">Ubicación (opcional)</label>
          <input type="text" id="ubicacion" name="ubicacion" placeholder="Ej: Sala de estar">
        </div>
        <div class="acciones-form">
          <button type="button" class="btn-cancelar" id="btn-cancelar-energysafe">Cancelar</button>
          <button type="submit" id="btn-registrar" class="btn-aceptar" disabled>Registrar Dispositivo</button>
        </div>
      </form>
      {% endif %}
    </div>
  </div>

  <!-- Modal para Seleccionar Ícono -->
  <div id="modal-seleccionar-icono" class="modal">
    <div class="modal-contenido">
      <span class="cerrar-modal" id="cerrar-modal-icono">&times;</span>
      <h2>Seleccionar Ícono</h2>
      <div class="grid-iconos">
        <div class="icono-item" data-icono="impresora">
          <img src="https://i.imgur.com/QTNk9c5.png" alt="Impresora">
          <span>Impresora</span>
        </div>
        <div class="icono-item" data-icono="computadora">
          <img src="https://i.imgur.com/G9W3kSS.png" alt="Computadora">
          <span>Computadora</span>
        </div>
        <div class="icono-item" data-icono="lavadora">
          <img src="https://i.imgur.com/HKZWrSP.png" alt="Lavadora">
          <span>Lavadora</span>
        </div>
        <div class="icono-item" data-icono="refrigerador">
          <img src="https://i.imgur.com/y6vQp4I.png" alt="Refrigerador">
          <span>Refrigerador</span>
        </div>
        <div class="icono-item" data-icono="microondas">
          <img src="https://i.imgur.com/QFNUZvz.png" alt="Microondas">
          <span>Microondas</span>
        </div>
        <div class="icono-item" data-icono="television">
          <img src="https://i.imgur.com/1cp16yr.png" alt="Televisión">
          <span>Televisión</span>
        </div>
        <div class="icono-item" data-icono="consola">
          <img src="https://i.imgur.com/MYNXLrB.png" alt="Consola">
          <span>Consola</span>
        </div>
        <div class="icono-item" data-icono="cargador">
          <img src="https://i.imgur.com/J3y4lRs.png" alt="Cargador">
          <span>Cargador</span>
        </div>
        <div class="icono-item" data-icono="pc">
          <img src="https://i.imgur.com/Xwh0HPl.png" alt="PC">
          <span>PC</span>
        </div>
      </div>
      <div class="acciones-form">
        <button type="button" class="btn-cancelar" id="btn-cancelar-icono">Cancelar</button>
        <button type="button" id="btn-confirmar-icono" class="btn-aceptar">Aceptar</button>
      </div>
    </div>
  </div>

  <!-- Footer Component para EnergySafe -->
<footer class="energysafe-footer">
  <div class="footer-top">
    <div class="footer-container">
      <div class="footer-row">
        <!-- Logo y descripción -->
        <div class="footer-column footer-about">
          <div class="footer-logo">
            <img src="https://i.imgur.com/2EhmVK6.png" alt="EnergySafe Logo">
          </div>
          <p class="footer-description">
            Soluciones inteligentes para el monitoreo y optimización del consumo energético en tu hogar y negocio.
          </p>
          <div class="footer-badges">
            <span class="eco-badge">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.18 6.68c1.22.57 2.28 1.43 3.15 2.5"></path><path d="M9.04 19.8c-3.18-.32-5.88-2.27-7.24-5.08"></path><path d="M9.04 4.2c-3.18.32-5.88 2.27-7.24 5.08"></path><path d="M18.18 17.32c1.22-.57 2.28-1.43 3.15-2.5"></path><path d="m5.97 15.32-.25 2.66c-.04.44.3.84.74.92l2.59.48c2.89.53 5.84-.83 7.25-3.39l.72-1.33c.23-.41.19-.92-.08-1.28l-1.59-2.11c-1.95-2.62-5.47-3.64-8.4-2.45l-2.36.96c-.41.17-.64.6-.57 1.04l.25 2.65"></path><path d="m15.91 13.04 1.58-1.98a.8.8 0 0 0-.02-1.05l-1.32-1.44"></path></svg>
              Eco-friendly
            </span>
            <span class="secure-badge">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path><path d="m9 12 2 2 4-4"></path></svg>
              Seguridad garantizada
            </span>
          </div>
        </div>

        <!-- Enlaces rápidos -->
        <div class="footer-column">
          <h3 class="footer-title">EnergySafe</h3>
          <ul class="footer-links">
            <li><a href="{% url 'home' %}">Inicio</a></li>
            <li><a href="{% url 'productos' %}">Nuestros productos</a></li>
            <li><a href="{% url 'download' %}">Aplicación móvil</a></li>
            <li><a href="/blog">Blog y recursos</a></li>
            <li><a href="{% url 'aboutus' %}">Nuestra empresa</a></li>
            <li><a href="/soporte">Centro de ayuda</a></li>
          </ul>
        </div>

        <!-- Productos -->
        <div class="footer-column">
          <h3 class="footer-title">Productos</h3>
          <ul class="footer-links">
            <li><a href="/products/energysafe-standard">EnergySafe Standard</a></li>
            <li><a href="/products/energysafe-pro">EnergySafe Pro</a></li>
            <li><a href="/products/accesorios">Accesorios</a></li>
            <li><a href="/garantia">Garantía y soporte</a></li>
            <li><a href="/descargas">Software y actualizaciones</a></li>
            <li><a href="/donde-comprar">Dónde comprar</a></li>
          </ul>
        </div>

        <!-- Soluciones -->
        <div class="footer-column">
          <h3 class="footer-title">Soluciones</h3>
          <ul class="footer-links">
            <li><a href="/para-hogares">Para hogares</a></li>
            <li><a href="/para-negocios">Para negocios</a></li>
            <li><a href="/integraciones">Integraciones</a></li>
            <li><a href="/calculadora">Calculadora de ahorro</a></li>
            <li><a href="/testimonios">Casos de éxito</a></li>
            <li><a href="/recursos">Recursos educativos</a></li>
          </ul>
        </div>

        <!-- Contacto y newsletter -->
        <div class="footer-column footer-contact">
          <h3 class="footer-title">Contáctanos</h3>
          <ul class="footer-contact-info">
            <li>
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
              <span>+52 (555) 123-4567</span>
            </li>
            <li>
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
              <span>contacto@energysafe.com</span>
            </li>
            <li>
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
              <span>Av. Tecnológico 123, Col. Centro<br>Ciudad de México, México</span>
            </li>
          </ul>
          
          <div class="footer-newsletter">
            <h4>Mantente informado</h4>
            <p>Suscríbete a nuestro boletín para recibir consejos y novedades</p>
            <form action="/suscribir" method="post" class="newsletter-form">
              {% csrf_token %}
              <input type="email" name="email" placeholder="Tu correo electrónico" required>
              <button type="submit" class="subscribe-btn">Suscribirme</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Apps y social -->
  <div class="footer-middle">
    <div class="footer-container">
      <div class="footer-row">
        <div class="footer-app-downloads">
          <h3>Descarga nuestra aplicación</h3>
          <div class="app-buttons">
            <a href="https://play.google.com/store" class="app-button" target="_blank">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3.609 1.814L13.792 12l-10.183 10.186c-2.05-.618-3.283-2.645-3.283-4.735V6.549c0-2.09 1.232-4.117 3.283-4.735zm13.4 2.766l-2.974 2.974L5.008 2.483l.2-.129C7.009 1.162 9.865 2.283 11.95 4.099l5.059.481zM1.654 1.916C1.798 1.843 1.946 1.778 2 1.724l17.336 8.708L16.626 12l-2.677 2.677-12.262-12.79c-.068.033-.016-.006-.033.029zm15.42 15.446c-2.443 2.156-5.015 2.96-6.945 2.354l-.199-.08 8.126-8.125 2.777 2.777-3.759 3.074z"/></svg>
              <span>Google Play</span>
            </a>
            <a href="https://www.apple.com/app-store/" class="app-button" target="_blank">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M16.462 8.624C16.928 8.065 17.205 7.278 17.116 6.5c-.771.062-1.729.421-2.284 1.001-.5.521-.96 1.365-.85 2.165.867.071 1.738-.357 2.48-1.042zm1.128 3.418c-1.721-.103-3.182 1.005-4.002 1.005-.82 0-2.064-.957-3.407-.932-1.749.026-3.371 1.059-4.256 2.677-1.838 3.157-.48 7.802 1.283 10.357.876 1.263 1.897 2.648 3.243 2.598 1.295-.05 1.79-.822 3.366-.822 1.576 0 2.048.822 3.429.797 1.43-.027 2.327-1.266 3.195-2.532.985-1.423 1.391-2.79 1.412-2.858-.032-.012-2.681-1.006-2.708-4.062-.024-2.542 2.061-3.762 2.144-3.822-1.191-1.731-3.02-1.911-3.679-1.949-1.711-.116-3.146.965-3.978.965-.831 0-2.078-.919-3.42-.919-1.736.004-3.37 1.064-4.254 2.7-1.799 3.142-.465 7.765 1.289 10.314.863 1.244 1.897 2.647 3.245 2.598 1.284-.05 1.784-.828 3.354-.828 1.568 0 2.028.828 3.416.803 1.418-.025 2.334-1.277 3.184-2.535.968-1.403 1.375-2.778 1.401-2.85-.035-.01-2.709-1.041-2.709-4.062 0-2.341 1.881-3.594 1.997-3.647z"/></svg>
              <span>App Store</span>
            </a>
          </div>
        </div>
        
        <div class="social-icons">
          <a href="https://facebook.com/" target="_blank" class="social-icon facebook">
            <img src="https://www.svgrepo.com/show/452196/facebook-1.svg" alt="Facebook" width="20" height="20">
          </a>
          <a href="https://twitter.com/" target="_blank" class="social-icon twitter">
            <img src="https://www.svgrepo.com/show/452123/twitter.svg" alt="Twitter" width="20" height="20">
          </a>
          <a href="https://www.instagram.com/" target="_blank" class="social-icon instagram">
            <img src="https://www.svgrepo.com/show/452229/instagram-1.svg" alt="Instagram" width="20" height="20">
          </a>
          <a href="https://www.youtube.com/" target="_blank" class="social-icon youtube">
            <img src="https://www.svgrepo.com/show/452138/youtube.svg" alt="YouTube" width="20" height="20">
          </a>
          <a href="https://www.linkedin.com/" target="_blank" class="social-icon linkedin">
            <img src="https://www.svgrepo.com/show/452047/linkedin-1.svg" alt="LinkedIn" width="20" height="20">
          </a>
        </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Certificaciones y premios -->
  <div class="footer-awards">
    <div class="footer-container">
      <div class="awards-row">
        <div class="award">
          <img src="{% static 'images/icons/iso-certified.svg' %}" alt="ISO Certified">
          <span>ISO 9001:2015</span>
        </div>
        <div class="award">
          <img src="{% static 'images/icons/energy-star.svg' %}" alt="Energy Star">
          <span>Energy Star Partner</span>
        </div>
        <div class="award">
          <img src="{% static 'images/icons/secure-payment.svg' %}" alt="Secure Payment">
          <span>Pagos Seguros</span>
        </div>
        <div class="award">
          <img src="{% static 'images/icons/eco-friendly.svg' %}" alt="Eco Friendly">
          <span>Eco Friendly</span>
        </div>
        <div class="award">
          <img src="{% static 'images/icons/innovative-tech.svg' %}" alt="Innovative Technology">
          <span>Tecnología Innovadora 2024</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom footer -->
  <div class="footer-bottom">
    <div class="footer-container">
      <div class="footer-row">
        <div class="copyright">
          &copy; 2025 EnergySafe. Todos los derechos reservados | <a href="/terminos-y-condiciones">Términos y Condiciones</a> | <a href="/aviso-de-privacidad">Aviso de Privacidad</a>
        </div>
        <div class="payment-methods">
          <span>Métodos de pago</span>
          <img src="{% static 'images/icons/visa.svg' %}" alt="Visa">
          <img src="{% static 'images/icons/mastercard.svg' %}" alt="Mastercard">
          <img src="{% static 'images/icons/amex.svg' %}" alt="American Express">
          <img src="{% static 'images/icons/paypal.svg' %}" alt="PayPal">
          <img src="{% static 'images/icons/mercadopago.svg' %}" alt="Mercado Pago">
        </div>
      </div>
    </div>
  </div>
</footer>

  <script>
    window.onscroll = function() {
      var header = document.querySelector('.header-container');
      if (window.scrollY > 50) {
          header.classList.add('scrolled');
      } else {
          header.classList.remove('scrolled');
      }
    };
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Referencias a elementos
      const btnAgregar = document.querySelectorAll('.btn_agregar');
      const modalDispositivo = document.getElementById('modal-agregar-dispositivo');
      const modalIcono = document.getElementById('modal-seleccionar-icono');
      const btnSeleccionarIcono = document.getElementById('btn-seleccionar-icono');
      const btnConfirmarIcono = document.getElementById('btn-confirmar-icono');
      const btnsCancel = document.querySelectorAll('.btn-cancelar');
      const btnsCerrar = document.querySelectorAll('.cerrar-modal');
      const iconoItems = document.querySelectorAll('.icono-item');
      const previewIconoContainer = document.getElementById('preview-icono-container');
      
      {% if not user_device %}
      // Variables para registrar EnergySafe
      const formEnergySafe = document.getElementById('form-energysafe');
      const numeroSerieInput = document.getElementById('numero-serie');
      const btnRegistrar = document.getElementById('btn-registrar');
      let deviceVerified = false;
      
      // Verificar número de serie al perder el foco
      if (numeroSerieInput) {
          numeroSerieInput.addEventListener('blur', function() {
              const numeroSerie = this.value.trim();
              
              if (numeroSerie.length < 5) {
                  showFeedback('El número de serie debe tener al menos 5 caracteres', 'error');
                  deviceVerified = false;
                  btnRegistrar.disabled = true;
                  return;
              }
              
              // Verificar el número de serie
              fetch(`/devices/verify/${numeroSerie}/`)
                  .then(response => response.json())
                  .then(data => {
                      console.log("Respuesta de verificación:", data);
                      if (data.exists) {
                          if (data.available) {
                              // El dispositivo existe y está disponible
                              showFeedback(data.message, 'success');
                              deviceVerified = true;
                              btnRegistrar.disabled = false;
                              
                              // Autocompletar el nombre si está vacío
                              const nombreInput = document.getElementById('nombre-energysafe');
                              if (nombreInput && !nombreInput.value && data.device_name) {
                                  nombreInput.value = data.device_name;
                              }
                          } else {
                              // El dispositivo no está disponible
                              showFeedback(data.message, 'error');
                              deviceVerified = false;
                              btnRegistrar.disabled = true;
                          }
                      } else {
                          // El dispositivo no existe
                          showFeedback(data.message, 'error');
                          deviceVerified = false;
                          btnRegistrar.disabled = true;
                      }
                  })
                  .catch(error => {
                      console.error('Error:', error);
                      showFeedback('Error al verificar el dispositivo', 'error');
                      deviceVerified = false;
                      btnRegistrar.disabled = true;
                  });
          });
      }
      
      // Registrar dispositivo EnergySafe
      if (formEnergySafe) {
          formEnergySafe.addEventListener('submit', function(e) {
              e.preventDefault();
              
              if (!deviceVerified) {
                  showFeedback('Primero debes verificar el número de serie', 'error');
                  return;
              }
              
              // Deshabilitar botón y mostrar carga
              btnRegistrar.disabled = true;
              btnRegistrar.innerHTML = 'Registrando... <span class="loading"></span>';
              
              // Crear FormData
              const formData = new FormData(this);
              
              // Enviar formulario
              fetch("{% url 'register_device' %}", {
                  method: 'POST',
                  body: formData,
                  headers: {
                      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                  }
              })
              .then(response => response.json())
              .then(data => {
                  console.log("Respuesta de registro:", data);
                  if (data.success) {
                      // Registro exitoso
                      showFeedback(data.message, 'success');
                      
                      // Recargar la página después de 1.5 segundos
                      setTimeout(() => {
                          window.location.reload();
                      }, 1500);
                  } else {
                      // Ocurrió un error
                      showFeedback(data.message, 'error');
                      btnRegistrar.disabled = false;
                      btnRegistrar.textContent = 'Registrar Dispositivo';
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
                  showFeedback('Error al registrar el dispositivo', 'error');
                  btnRegistrar.disabled = false;
                  btnRegistrar.textContent = 'Registrar Dispositivo';
              });
          });
      }
      
      // Función para mostrar feedback
      function showFeedback(message, type) {
          const feedbackElement = document.getElementById('serie-feedback');
          if (feedbackElement) {
              feedbackElement.textContent = message;
              feedbackElement.className = `feedback ${type}`;
              feedbackElement.style.display = 'block';
              
              // Ocultar después de unos segundos si es éxito
              if (type === 'success') {
                  setTimeout(() => {
                      feedbackElement.style.opacity = '0';
                      setTimeout(() => {
                          feedbackElement.style.display = 'none';
                          feedbackElement.style.opacity = '1';
                      }, 500);
                  }, 3000);
              }
          }
      }
      {% else %}
      // Variables para agregar electrodoméstico
      const formElectrodomestico = document.getElementById('form-electrodomestico');
      let iconoSeleccionado = {
          nombre: 'television',
          src: 'https://i.imgur.com/1cp16yr.png'
      };
      
      // Abrir modal de seleccionar ícono
      if (btnSeleccionarIcono) {
          btnSeleccionarIcono.addEventListener('click', function() {
              modalIcono.style.display = 'block';
          });
      }
      
      // Seleccionar ícono
      iconoItems.forEach(item => {
          item.addEventListener('click', function() {
              // Quitar selección previa
              iconoItems.forEach(i => i.classList.remove('seleccionado'));
              // Agregar selección actual
              this.classList.add('seleccionado');
              
              // Obtener el nombre del ícono desde el atributo data-icono del div
              iconoSeleccionado = {
                  nombre: this.getAttribute('data-icono'),
                  src: this.querySelector('img').src
              };
          });
      });
      
      // Confirmar selección de ícono
      if (btnConfirmarIcono) {
          btnConfirmarIcono.addEventListener('click', function() {
              if (iconoSeleccionado) {
                  // Actualizar campo oculto con el nombre del ícono
                  const iconoInput = document.getElementById('icono-seleccionado');
                  if (iconoInput) {
                      iconoInput.value = iconoSeleccionado.nombre;
                  }
                  
                  // Cerrar modal de íconos
                  modalIcono.style.display = 'none';
              } else {
                  alert('Por favor, selecciona un ícono');
              }
          });
      }
      
      // Envío de formulario de electrodoméstico
      if (formElectrodomestico) {
          formElectrodomestico.addEventListener('submit', function(e) {
              e.preventDefault();
              
              // Validar campos requeridos
              const nombre = document.getElementById('nombre-dispositivo').value;
              const voltaje = document.getElementById('voltaje').value;
              
              if (!nombre || !voltaje) {
                  alert('Por favor, completa todos los campos requeridos');
                  return;
              }
              
              // Deshabilitar botón y mostrar carga
              const submitBtn = this.querySelector('[type="submit"]');
              submitBtn.disabled = true;
              submitBtn.innerHTML = 'Procesando... <span class="loading"></span>';
              
              // Crear FormData
              const formData = new FormData(this);
              
              // Enviar formulario
              fetch(this.action, {
                  method: 'POST',
                  body: formData,
                  headers: {
                      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                  }
              })
              .then(response => response.json())
              .then(data => {
                  if (data.success) {
                      // Éxito
                      alert(data.message);
                      
                      // Cerrar modal y recargar página
                      modalDispositivo.style.display = 'none';
                      window.location.reload();
                  } else {
                      // Error
                      alert(data.message);
                      submitBtn.disabled = false;
                      submitBtn.textContent = 'Aceptar';
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
                  alert('Error al agregar el electrodoméstico');
                  submitBtn.disabled = false;
                  submitBtn.textContent = 'Aceptar';
              });
          });
      }
      {% endif %}
      
      // Abrir modal
      btnAgregar.forEach(btn => {
          btn.addEventListener('click', function() {
              modalDispositivo.style.display = 'block';
          });
      });
      
      // Cerrar modales con botón X
      btnsCerrar.forEach(btn => {
          btn.addEventListener('click', function() {
              modalDispositivo.style.display = 'none';
              if (modalIcono) modalIcono.style.display = 'none';
          });
      });
      
      // Cerrar modales con botón cancelar
      btnsCancel.forEach(btn => {
          btn.addEventListener('click', function() {
              modalDispositivo.style.display = 'none';
              if (modalIcono) modalIcono.style.display = 'none';
          });
      });
      
      // Cerrar al hacer clic fuera del modal
      window.addEventListener('click', function(e) {
          if (e.target === modalDispositivo) {
              modalDispositivo.style.display = 'none';
          }
          if (modalIcono && e.target === modalIcono) {
              modalIcono.style.display = 'none';
          }
      });
      
      // Botones de Más Información
      document.querySelectorAll('.btn_mas_info').forEach(btn => {
          btn.addEventListener('click', function() {
              const applianceId = this.getAttribute('data-id');
              if (applianceId) {
                  window.location.href = `/devices/appliance/${applianceId}/`;
              }
          });
      });
    });
  </script>
</body>
</html>